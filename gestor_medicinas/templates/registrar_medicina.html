{% extends 'base.html' %}
{% load static %}

{% block head %}
    <link rel="stylesheet" href="{% static 'css/registro_edicion.css' %}">
    <title>{% block title %}Crear Medicina{% endblock %}</title>
{% endblock %}

{% block body %}
<main>
    
    <form method="post" enctype="multipart/form-data" class="form">
        {% csrf_token %}
        <h1 class="titulo2">Registrar nueva medicina</h1>

        <div class="contenedor_campo_img">
            <label for="imagen_medicina" class="custom-file-upload">Imagen</label>
            <input type="file" id="imagen_medicina" name="imagen_medicina" accept="image/*" class="boton_imagen" style="overflow:hidden;">

            <!-- Elemento donde mostrar el nombre de la imagen -->
            <span id="nombre_imagen">Ninguna imagen seleccionada</span>

            <script>
                const inputImagen = document.getElementById('imagen_medicina');
                const spanNombre = document.getElementById('nombre_imagen');

                inputImagen.addEventListener('change', function() {
                    if (this.files && this.files.length > 0) {
                        spanNombre.textContent = this.files[0].name;
                    } else {
                        spanNombre.textContent = 'Ninguna imagen seleccionada';
                    }
                });
            </script>
        </div>
       
        <div class="contenedor_campo">
            <label for="desc_medicina">Descripción:</label>
            <input type="text" id="desc_medicina" name="desc_medicina" maxlength="400" minlength="3" required value="{{ desc_medicina|default_if_none:'' }}" class="campo">
        </div>
        
        <div class="contenedor_campo">
            <label for="cantidad">Cantidad:</label>
            <!-- Validación para los dígitos después -->
            <input type="number" step="0.01" id="cantidad" name="cantidad" min="0" max="50000" value="{{ cantidad|default_if_none:'0' }}" required class="campo">
        </div>

        <div class="contenedor_campo">
            <label for="medida">Tipo de medida:</label>
            <select name="medida" class="campo">
                {% for medidas_leidas in medidas %}
                <option value="{{ medidas_leidas.id_medida }}">{{ medidas_leidas.desc_medida }}</option>
                {% endfor %}
            </select>
        </div>  

        <div class="contenedor_campo">
            <label for="almacen_perteneciente">Perteneciente:</label>
            <select id="almacen_perteneciente" name="almacen_perteneciente" class="campo">
                {% for almacen in almacenes_activos %}
                    <option value="{{ almacen.id_almacen }}"
                        {% if almacen_perteneciente|stringformat:'s' == almacen.id_almacen|stringformat:'s' %}
                            selected
                        {% endif %}
                    >{{ almacen.desc_almacen }}</option>
                {% endfor %}
            </select>
        </div>  

        <div class="caja_botones">
            <button type="submit" class="boton_crear">Crear Medicina</button>

            <a href="{% url 'panel_principal' %}?page={{ request.GET.page }}&filtro_desc_medicina={{ request.GET.filtro_desc_medicina|urlencode }}&filtro_almacen={{ request.GET.filtro_almacen|urlencode }}" class="boton_volver">Volver</a>
        </div>
    </form>

</main>
{% endblock %}
