{% extends 'base.html' %}
{% load static %}

{% block head %}
    <link rel="stylesheet" href="{% static 'css/registro_edicion.css' %}">
    <title>{% block title %}Editar Medicina{% endblock %}</title>
{% endblock %}

{% block body %}
<main>

    <form method="post" enctype="multipart/form-data" class="form">
        {% csrf_token %}

        {% if medicina_obj.imagen_medicina %}
            <img src="{{ medicina_obj.imagen_medicina.url }}" alt="Imagen medicina" class="imagen_juguete">
        {% else %}
            <p class="text_sin_imagen">Sin imagen</p>    
        {% endif %}

        <h1 class="titulo2">Editar medicina</h1>
        <input type="hidden" value="{{ medicina_obj.desc_medicina|default_if_none:'' }}" name="desc_medicina_vieja">

        <div class="contenedor_campo_img">
            <label for="imagen_medicina" class="custom-file-upload">Nueva imagen</label>
            <input type="file" id="imagen_medicina" name="imagen_medicina" accept="image/*" class="boton_imagen" style="overflow:hidden;">

            <span id="nombre_imagen">Ninguna imagen seleccionada</span>

            <script>
                const inputImagen = document.getElementById('imagen_medicina');
                const spanNombre = document.getElementById('nombre_imagen');

                inputImagen.addEventListener('change', function() {
                    if (this.files && this.files.length > 0) {
                        spanNombre.textContent = this.files[0].name;
                    } else {
                        spanNombre.textContent = 'Ninguna imagen seleccionada';
                    }
                });
            </script>
        </div>

        <div class="contenedor_campo">
            <label for="desc_medicina">Descripci√≥n:</label>
            <input type="text" id="desc_medicina" name="desc_medicina" maxlength="400" minlength="3" required value="{{ medicina_obj.desc_medicina|default_if_none:'' }}" class="campo">
        </div>       

        <div class="contenedor_campo">
            <label for="cantidad">
                Cantidad 
                {% if medicina_obj.medida_medicina %}
                    ({{ medicina_obj.medida_medicina.desc_medida }})
                {% endif %}:
            </label>

            <input type="number" step="0.01" max="50000" id="cantidad" name="cantidad" min="0" required 
            value="{{ medida_formateada }}" class="campo">
            
            
        </div>      

        <div class="contenedor_campo">
            <label for="almacen_perteneciente">Almacen:</label>
            <select id="almacen_perteneciente" name="almacen_perteneciente" class="campo">
                {% for almacen in almacenes_activos %}
                    <option value="{{ almacen.id_almacen }}" 
                        {% if medicina_obj.almacen_perteneciente and almacen.id_almacen == medicina_obj.almacen_perteneciente.id_almacen %}
                            selected
                        {% endif %}
                    >{{ almacen.desc_almacen }}</option>
                {% endfor %}
            </select>
        </div>    

        <div class="caja_botones">
            <button type="submit" class="boton_crear">Guardar cambios</button>
            <a href="{% url 'panel_principal' %}?page={{ request.GET.page }}&filtro_desc_medicina={{ request.GET.filtro_desc_medicina|urlencode }}&filtro_almacen={{ request.GET.filtro_almacen|urlencode }}" class="boton_volver">Volver</a>
        </div>

    </form>
</main>
{% endblock %}
