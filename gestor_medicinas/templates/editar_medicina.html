{% extends 'base.html' %}
{% load static %}

{% block head %}
    <link rel="stylesheet" href="{% static 'css/registro_edicion.css' %}">
    <title>{% block title %}Editar Medicina{% endblock %}</title>
{% endblock %}

{% block body %}
<main>
    <form method="post" enctype="multipart/form-data" class="form">
        {% csrf_token %}
        <h1 class="titulo2">Editar Medicina</h1>
        {% if medicina_obj.imagen_medicina %}
            <div class="contenedor_campo_img">
                <img src="{{ medicina_obj.imagen_medicina.url }}" alt="Imagen medicina" class="imagen_juguete" id="imagenPreview">
            </div>
        {% else %}
            <img src="" alt="Imagen medicina" class="imagen_juguete" id="imagenPreview" style="display:none;">
        {% endif %}

        <div class="bloque_form_campos2">
            <label for="imagen_medicina" class="custom-file-upload">Cambiar imagen</label>

            <input type="file" id="imagen_medicina" name="imagen_medicina" accept="image/*" class="boton_imagen">
            <span id="nombre_imagen">Ninguna imagen seleccionada</span>
        </div>
    
        <script>
            const inputImagen = document.getElementById('imagen_medicina');
            const spanNombre = document.getElementById('nombre_imagen');
            const imagenPreview = document.getElementById('imagenPreview');

            inputImagen.addEventListener('change', function() {
                if (this.files && this.files.length > 0) {
                    // Mostrar nombre del archivo
                    spanNombre.textContent = this.files[0].name;

                    // Leer la imagen y mostrarla
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        imagenPreview.src = e.target.result;
                        imagenPreview.style.display = 'block'; // asegurar que se muestre
                    }
                    reader.readAsDataURL(this.files[0]);
                } else {
                    spanNombre.textContent = 'Ninguna imagen seleccionada';
                    // Opcional: volver a mostrar la imagen original si quieres
                    // Si quieres que vuelva a la original, puedes guardar su src al cargar la p√°gina
                }
            });
        </script>

        
        <div class="bloque_form_campos">
            <div class="cont_campos">
                <label for="medicina">Medicina:</label>
                <input type="text" id="medicina" name="medicina" maxlength="400" minlength="3" value="{{ medicina_obj.medicina }}" required class="campo">
            </div>

            <div class="cont_campos">
                <label for="presentacion">Presentacion:</label>
                <select name="presentacion" class="campo" required>
                    {% for presentacion in presentaciones %}
                        <option value="{{ presentacion.id_presentacion_medicamento }}" {% if presentacion.id_presentacion_medicamento == medicina_obj.presentacion.id_presentacion_medicamento %}selected{% endif %}>
                            {{ presentacion.desc_presentacion_medicamento }}
                        </option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="bloque_form_campos">
            <div class="cont_campos">
                <label for="cantidad">Cantidad:</label>
                <input type="number" id="cantidad" name="cantidad" min="0" max="100000" value="{{ medicina_obj.cantidad }}" required class="campo">
            </div>

            <div class="cont_campos">
                <label for="laboratorio">Laboratorio:</label>
                <input type="text" id="laboratorio" name="laboratorio" maxlength="350" value="{{ medicina_obj.laboratorio }}" required class="campo">
            </div>
        </div>

        <div class="bloque_form_campos">
            <div class="cont_campos">
                <label for="ubicacion">Ubicacion:</label>
                <select name="ubicacion" class="campo" required>
                    {% for ubicacion_leida in ubicaciones_activas %}
                        <option value="{{ ubicacion_leida.id_ubicacion }}" {% if ubicacion_leida.id_ubicacion == medicina_obj.ubicacion.id_ubicacion %}selected{% endif %}>
                            {{ ubicacion_leida.desc_ubicacion }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="cont_campos">
                <label for="anaquel">Anaquel:</label>
                <input type="text" id="anaquel" name="anaquel" maxlength="100" value="{{ medicina_obj.anaquel }}" required class="campo">
            </div>
        </div>

        <div class="bloque_form_campos">
            <div class="cont_campos2">
                <label for="descripcion">Descripcion:</label>
                <textarea name="descripcion" class="campo_textarea" required>{{ medicina_obj.descripcion }}</textarea>
            </div>
        </div>

        <div class="bloque_form_campos">
            <div class="cont_campos2">
                <label for="observaciones">Observaciones:</label>
                <textarea name="observaciones" class="campo_textarea">{{ medicina_obj.observaciones }}</textarea>
            </div>
        </div>

        <div class="caja_botones">
            <button type="submit" class="boton_crear">Guardar Cambios</button>
            <a href="{% url 'panel_principal' %}?{{ request.GET.urlencode }}" class="boton_volver">Volver</a>
        </div>
    </form>

</main>
{% endblock %}